# -*- coding: utf-8 -*- #

require 'yaml'

module LassoKeywords
  extend self
  def keywords
    ::YAML.load_file(File.join(__dir__, 'lasso/keywords.yml'))
  end

  def source(&b)
    yield   '# -*- coding: utf-8 -*- #'
    yield   '# frozen_string_literal: true'
    yield   ''
    yield   '# automatically generated by `rake builtins:lasso`'
    yield   'module Rouge'
    yield   '  module Lexers'
    yield   '    def Lasso.keywords'
    yield   '      @keywords ||= {}.tap do |h|'
    keywords.each do |key, value|
      yield "        h[#{key.inspect}] = Set.new #{value}"
    end
    yield   '      end'
    yield   '    end'
    yield   '  end'
    yield   'end'
  end
end

namespace :builtins do
  task :lasso do
    File.open('lib/rouge/lexers/lasso/keywords.rb', 'w') do |f|
      LassoKeywords.source { |line| f.puts line }
    end
  end
end
